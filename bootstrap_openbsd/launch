#!/bin/sh

[ "$(uname)" = Linux ] && SANDBOX="-sandbox on"

if [ -z "$1" ]; then
    echo "Usage: $(basename "$0") <vmname>"
    exit 1
fi

vmname="vm$1"

if [ ! -f "vms/${vmname}.qcow2" ]; then
    echo "No such VM"
    exit 1
fi

qemu-system-x86_64 \
    ${SANDBOX} \
    -machine type=q35,accel=kvm:hvf \
    -nographic \
    -smp 2 \
    -m 2G \
    -drive if=virtio,file="vms/${vmname}.qcow2",format=qcow2,media=disk \
    -nic user,ipv6=off,model=virtio
